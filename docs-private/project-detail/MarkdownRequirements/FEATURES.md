# Function Requirements (機能要件一覧)

> [!NOTE]
> アプリケーションが満たすべき機能要件（User Story / Functional Requirement）を定義します。
> この一覧はSNSアプリ（Twitterクローン）のコア機能を網羅しています。

## 1. ユーザー＆認証機能 (User & Auth Features)

### 認証・アカウント (US001 - US003)

|   US ID   | User Story                                                   |   FN ID   | Feature Name     | Detail / Requirements                                        |
| :-------: | :----------------------------------------------------------- | :-------: | :--------------- | :----------------------------------------------------------- |
| **US001** | 新規ユーザーは，システムに会員登録することができる。         | **FN001** | 登録認証機能     | Sanctum API Tokenによるユーザー登録APIの呼び出し             |
|           |                                                              | **FN002** | バリデーション   | Zod (Frontend) + FormRequest (Backend) による厳格な検証      |
|           |                                                              | **FN003** | エラーメッセージ | 422レスポンスに基づく、各入力フィールド下へのエラー表示      |
|           |                                                              | **FN004** | 初回登録時設定   | アカウント作成後、自動でログイン状態となりタイムラインへ遷移 |
| **US002** | 既存ユーザーは，システムにログインすることができる。         | **FN005** | ログイン認証機能 | Credentials (Email/Password) によるAPI認証とToken発行        |
|           |                                                              | **FN006** | トークン管理     | BFFルートを介した HttpOnly Cookie へのセキュアな保存         |
|           |                                                              | **FN007** | エラーメッセージ | 「認証情報が一致しません」等のグローバルエラー表示           |
| **US003** | ログインユーザーは，システムからログアウトすることができる。 | **FN008** | ログアウト機能   | トークンの破棄とCookieの削除。ログイン画面へのリダイレクト   |

---

## 2. コア機能 (Core SNS Features)

### ツイート機能 (US004 - US006)

|   US ID   | User Story                                                 |   FN ID   | Feature Name     | Detail / Requirements                                              |
| :-------: | :--------------------------------------------------------- | :-------: | :--------------- | :----------------------------------------------------------------- |
| **US004** | ログインユーザーは，新しいツイートを投稿できる。           | **FN009** | 投稿作成機能     | 140文字以内のテキスト投稿。Zodによる文字数制限バリデーション。     |
|           |                                                            | **FN010** | リアルタイム更新 | 投稿完了後、再読み込みなしでタイムラインの先頭に追加される。       |
| **US005** | ユーザーは，自分や他人のツイートの詳細を見ることができる。 | **FN011** | 詳細表示機能     | ツイート単体の画面。投稿日時、いいね数、投稿者情報を表示。         |
| **US006** | ログインユーザーは，自分のツイートのみを削除できる。       | **FN012** | 投稿削除機能     | 自身の投稿にのみ「削除」ボタンを表示。確認モーダルを経由して削除。 |
|           |                                                            | **FN013** | 削除のUI反映     | 削除成功時、タイムラインから該当ツイートをリアルタイムに除外する。 |

### タイムライン構築 (US007 - US008)

|   US ID   | User Story                                                 |   FN ID   | Feature Name   | Detail / Requirements                                                        |
| :-------: | :--------------------------------------------------------- | :-------: | :------------- | :--------------------------------------------------------------------------- |
| **US007** | ユーザーは，最新のツイート一覧（全体TL）を閲覧できる。     | **FN014** | 全体取得機能   | 全ユーザーの投稿を新しい順で取得し表示する。                                 |
|           |                                                            | **FN015** | 無限スクロール | React Query（`useInfiniteQuery`）とCursor Paginationを利用した追加読み込み。 |
| **US008** | ユーザーは，フォロー中のユーザーのツイートのみを閲覧できる | **FN016** | フォローTL機能 | フォロイーの投稿のみを抽出したタイムラインタブの切り替え。                   |

### エンゲージメント機能 (US009)

|   US ID   | User Story                                                 |   FN ID   | Feature Name       | Detail / Requirements                                                                              |
| :-------: | :--------------------------------------------------------- | :-------: | :----------------- | :------------------------------------------------------------------------------------------------- |
| **US009** | ログインユーザーは，ツイートに「いいね」をすることができる | **FN017** | いいね機能         | いいねの付与（POST）と解除（DELETE）のトグル機能。                                                 |
|           |                                                            | **FN018** | 楽観的UI更新       | APIのレスポンスを待たず、クリック瞬間にUIのハートを点灯させ、カウントを+1する。(Optimistic Update) |
|           |                                                            | **FN019** | エラーロールバック | 通信失敗時は、瞬時に元の状態（いいね未実施）に戻しトースト通知を出す。                             |

### ユーザー間アクション・プロフィール (US010 - US011)

|   US ID   | User Story                                               |   FN ID   | Feature Name     | Detail / Requirements                                          |
| :-------: | :------------------------------------------------------- | :-------: | :--------------- | :------------------------------------------------------------- |
| **US010** | ユーザーは，対象のユーザーを「フォロー」することができる | **FN020** | フォロー機能     | フォロー/アンフォローのトグル機能。                            |
|           |                                                          | **FN021** | 状態のUI反映     | リレーション状態をもとに「フォロー中」ボタンの表示切り替え。   |
| **US011** | ユーザーは，特定ユーザーのプロフィール画面を閲覧できる。 | **FN022** | プロフィール表示 | ユーザーIDや自己紹介、フォロー/フォロワー数を表示。            |
|           |                                                          | **FN023** | 投稿一覧タブ     | そのユーザーの「ツイート」「いいねした投稿」を切り替えて表示。 |

### コメント（リプライ）機能 (US012 - US013)

|   US ID   | User Story                                                 |   FN ID   | Feature Name       | Detail / Requirements                                                                                |
| :-------: | :--------------------------------------------------------- | :-------: | :----------------- | :--------------------------------------------------------------------------------------------------- |
| **US012** | ログインユーザーは，ツイートに対してコメントを投稿できる。 | **FN024** | コメント投稿機能   | 元ツイートに対する返信（140文字以内）。アーキテクチャ上は親ID(`parent_id`)を持つツイートとして扱う。 |
|           |                                                            | **FN025** | リストリアルタイム | 投稿後、詳細画面のコメント一覧の先頭に即座に追加反映される。                                         |
| **US013** | ユーザーは，ツイート詳細画面でコメント一覧を閲覧できる。   | **FN026** | コメント一覧取得   | ツイート詳細画面の下部に、該当ツイートへの返信（子ツイート）を一覧表示する。                         |
