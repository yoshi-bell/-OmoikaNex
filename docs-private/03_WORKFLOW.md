# 🔴 メタ定義: このファイルの責務 (AIエージェント用)

> **AIエージェントへの指示 (Prompt Repetition Strategy):**
> このファイルには遵守すべき「厳格なルール」と「手順」が記載されています.
> 内容を**「合計2回」**読み込み、特に「開発ルール」と「プロセス記録ルール」を脳内に強くインデックスしてから作業を開始してください。

- **役割:** 開発の手順（ロードマップ）、チェックリスト、動作確認ルール、およびGitコミットルールの「執行」定義。
- **読むべきタイミング:** 新しいタスクに着手する前、作業中の進捗確認、および `git push` を行う直前。
- **思考の優先順位:** 手順とルールに関して最優先。独自の判断でステップをスキップしてはならない。

---

# SNSアプリ 開発ワークフロー (Workflow & Checklists)

## 開発ルール (Rules for Execution)

### 動作確認ルール (Verification Standards)

ロードマップの各タスクを「完了」とする前に、**必ず** 以下の検証を行い、正常動作を確証すること。

- **バックエンド (Logic):**
    - **データ整合性:** DBの中身を直接確認し、データが正しく保存・更新されているか。
    - **型定義:** PHPの引数・戻り値の型が、最新のビジネスロジックと一致しているか。
    - **API機能:** OpenAPI仕様に則った正しいステータスとデータ (JSON) を返しているか。
- **フロントエンド (Next.js/UI):**
    - **型安全:** ZodバリデーションおよびReact Queryからのデータ型が正しく認識されているか。
    - **状態管理:** Zustandストアのグローバルな状態が予測通りに更新されているか。
    - **楽観的UI:** いいね処理などのAPIレスポンスを待たないUI更新が正常に機能しているか。
- **ネットワーク通信:**
    - Networkタブでブラウザへ送信されるデータの最適化（過剰なリレーション先の読み込み防止など）がされているか。

### プロセス記録ルール (Mandatory)

`git push` を実行する直前に、**必ず** 以下の手順を実行すること。

#### ステップ 1: 開発ログの記録

- **対象ファイル:** `docs-private/07_DEV_LOG.md`
- **アクション:** 実装内容、技術的判断、エラーと解決策を追記する。（`write_file`ではなく`replace`による追記を徹底すること）

#### ステップ 2: 復旧マニュアルの整合性確認

- **対象ファイル:** `docs-private/01_AGENT_RECOVERY_MANUAL.md`
- **アクション:** `07_DEV_LOG.md` の更新内容に基づき、ステータスを最新化する。

#### ステップ 3: ワークフローの更新

- **対象ファイル:** `docs-private/03_WORKFLOW.md`
- **アクション:** 完了したタスクのチェックボックスをオンにし、「現在進行中のタスク」を更新する。

#### ステップ 4: Gitコミット

- **言語:** 日本語で記述すること (`feat:`, `fix:`, `docs:`, `chore:`, `refactor:` プレフィックスを使用)。

---

## 🚀 個人開発向け PR 運用ルール (Personal PR Flow)

開発スピードを維持しつつ、品質を担保するためのフロー。

1. **ブランチ作成:** 機能追加時は `feature/xxx`、修正時は `fix/xxx` を作成。
2. **PR作成:** 実装が完了したらPull Requestを作成。
3. **セルフレビュー・マージ:** 差分をチェックした上で `main` ブランチへマージ（Squash推獎）。

---

## 【現在進行中のタスク】 (Active Context)

> AIエージェントは作業中、常にここを更新すること。

**現在のフェーズ:** Phase 1: インフラと「型同期」パイプラインの初期構築
**現在のアクティブタスク:** プロジェクトドキュメントの初期再編と基盤ルールの確立
**ステータス:** 過去プロジェクトのドキュメントをベースに、新しいSNSアプリ独自のモダン完全分離アーキテクチャ(Laravel + Next.js + トークン認証)に合わせたルール整備を行っている。

---

## 1. SNSアプリ ロードマップ (SNS Roadmap)

### Phase 1: インフラと「型同期」パイプラインの初期構築

- [x] **バックエンド構築:** Laravel 12のAPIセットアップ、Sanctumトークン認証基盤の準備。
- [ ] **フロントエンド構築:** Next.js 15 (App Router) プロジェクトの生成、Tailwind設定。
- [ ] **型同期確立:** `Scribe` (または `Scramble`) の導入と `openapi-typescript` による `schema.d.ts` の連携。

### Phase 2: 「鉄壁のフォーム基盤」の構築

- [ ] **Zod 導入:** フロント用Zodスキーマ（ログイン、登録など）の作成と Brand型 の設定。
- [ ] **RHF 導入:** ZodとReact Hook Formを統合させた認証フォームの実装。
- [ ] **Shadcn UI:** フォーム入力要素やボタンコンポーネントの導入。

### Phase 3: データフェッチと状態管理

- [ ] **TanStack Query 導入:** 記事データ・タイムライン・いいね取得等のReact Queryクエリ基盤の構築。
- [ ] **Zustand 導入:** グローバルトースト通知や認証情報のクライアントストア管理。

### Phase 4: コア機能（SNSロジック）の開発

- [ ] **認証エンドポイント:** API Token発行・HttpOnly Cookie化による安全な認証フロー。
- [ ] **ツイート機能:** テキスト投稿の実装（画像投稿機能は現時点では見送り）。
- [ ] **タイムライン構築:** Infinite Scroll（Cursor Pagination）を伴う時系列TLの実装。
- [ ] **エンゲージメント:** 「いいね」「リポスト」等の多対多リレーションとAPI化。
- [ ] **コメント機能:** 自己参照リレーションを使用した返信機能と詳細画面での一覧表示。
- [ ] **フォロー機能:** 自己参照リレーションを利用したフォローシステムの実装。

### Phase 5: 高度なUI/UXとパフォーマンス

- [ ] **Optimistic Update:** いいね機能の楽観的UI更新を実装。
- [ ] **N+1 撲滅:** Backend側の Strict Mode の有効化とEager Loadingの徹底検証。
